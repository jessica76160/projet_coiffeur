{% extends 'base.html.twig' %}

{% block main %}

    <div id="bandeau"><strong>Lieu</strong> / Nb personnes / Heure / Prestations</div>

    <span id="retour">
        <a href="/accueil"><img src="{{asset('img/fleche.png')}}" id="fleche"></a>
    </span>
    <form method="POST">
        <div id="adresse">
          <img src="{{asset('img/localisation.png')}}" id="icone_localisation">{{ form_widget(form.adresse) }}
      </div>
      <div id="perimetre">
          <img src="{{asset('img/radar.png')}}" id="icone_radar">{{ form_widget(form.perimetre) }}
      </div>
      
      {{ form_widget(form.lat) }}
      {{ form_widget(form.lng) }}
      
      <div class="bouton_suivant" id="bouton_suivant_adresse">
        <button type="submit" class="btn btn-secondary btn-lg" id="rechercher_salon">Suivant</button>
      </div>
    </form>
    
    <div id="map">
        
      </div>
    {% endblock %}
    {% block javascripts %}
      {{parent()}}
      <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?libraries=places&key=AIzaSyCTj6fqFBlP4_7uPjXbOgipj4fknJoc8sg"></script>
      <script>

      function initializeAutocomplete(id) {
        var element = document.getElementById(id);
        if (element) {
            var autocomplete = new google.maps.places.Autocomplete(element, { types: ['geocode'] });
            google.maps.event.addListener(autocomplete, 'place_changed', onPlaceChanged);
        }
      }

function onPlaceChanged() {

  var place = this.getPlace();
  lat=place.geometry.location.lat();
  lng=place.geometry.location.lng();
  
  document.getElementById('form_lat').value=lat;
  document.getElementById('form_lng').value=lng;

  var france = new google.maps.LatLng(lat,lng);
  
  if(document.getElementById('form_perimetre').value!=""){
    var perimetre=document.getElementById('form_perimetre').value;
    perimetre=parseFloat(perimetre);
  }else{
    var perimetre=0;
  }

  myMap(france,perimetre);

    
}
$('#form_perimetre').on('change', function(e) {

  if(document.getElementById('form_lat').value!=""){
    var lat=document.getElementById('form_lat').value;
    var lng=document.getElementById('form_lng').value;
  }else{
    var lat=46.227638;
    var lng=2.213749000000007;
    
  }

  var france = new google.maps.LatLng(lat,lng);
  
    if(document.getElementById('form_perimetre').value!=""){
    var perimetre=document.getElementById('form_perimetre').value;
    perimetre=parseFloat(perimetre);
  }else{
    var perimetre=0;
  }

  myMap(france,perimetre);
});


function myMap(france,perimetre) {

  var mapOptions = {center: france,zoom:7};
  var mapCanvas = document.getElementById("map");
  
  var map = new google.maps.Map(mapCanvas,mapOptions);

  var marker = new google.maps.Marker({position:france});
  marker.setMap(map);

  var myCity = new google.maps.Circle({
    center: france,
    radius: perimetre,
    strokeColor: "#0000FF",
    strokeOpacity: 0.8,
    strokeWeight: 2,
    fillColor: "#0000FF",
    fillOpacity: 0.4
  });
  myCity.setMap(map);
}

google.maps.event.addDomListener(window, 'load', function() {
    initializeAutocomplete('form_adresse');
    var france = new google.maps.LatLng(46.227638,2.213749000000007);
    var perimetre=0;

    myMap(france,perimetre);
});
</script>

{% endblock %}


